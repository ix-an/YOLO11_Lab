<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>ğŸ¬ è§†é¢‘æ™ºèƒ½æ£€æµ‹</title>

    <style>
        /* ===== æ•´ä½“ï¼šæ—¥ç³»å¥¶æ²¹è“ / å°çº¢ä¹¦æ„Ÿ ===== */
        body {
            margin: 0;
            background: #f3f7fb;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI",
                         "PingFang SC", "Microsoft YaHei", sans-serif;
            color: #2f3a45;
        }

        .container {
            max-width: 1100px;
            margin: 50px auto;
            padding: 42px;
            background: #ffffff;
            border-radius: 24px;
            box-shadow: 0 16px 36px rgba(0, 0, 0, 0.08);
        }

        h1 {
            font-size: 32px;
            margin-bottom: 6px;
        }

        .subtitle {
            font-size: 16px;
            color: #6b7b8c;
            margin-bottom: 34px;
        }

        /* ===== æ“ä½œåŒºåŸŸï¼šæŒ‰é’®åŒä¸€è¡Œ ===== */
        .control-area {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 18px;
            flex-wrap: wrap;
            margin-bottom: 18px;
        }

        input[type="file"] {
            padding: 12px 14px;
            font-size: 15px;
            border-radius: 12px;
            border: 1px solid #d6e0ea;
            background: #f9fcff;
            width: 280px;
        }

        .btn {
            padding: 12px 26px;
            font-size: 15px;
            border-radius: 14px;
            border: none;
            cursor: pointer;
            transition: all 0.25s ease;
            white-space: nowrap;
        }

        .upload-btn {
            background: #8fb3ff;
            color: #fff;
        }

        .upload-btn:hover {
            background: #7aa3ff;
        }

        .detect-btn {
            background: #7fd1c7;
            color: #fff;
        }

        .detect-btn:hover {
            background: #6fc2b8;
        }

        /* ===== çŠ¶æ€è¯´æ˜ ===== */
        .status-text {
            margin-top: 14px;
            font-size: 15px;
            color: #5b6b7a;
            text-align: center;
        }

        /* ===== è§†é¢‘å±•ç¤ºåŒºåŸŸï¼šå¼ºåˆ¶å±…ä¸­ ===== */
        .video-box {
            margin-top: 36px;
            padding: 28px;
            background: #f6f9fc;
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .placeholder {
            font-size: 16px;
            color: #8a9aaa;
            padding: 60px 0;
        }

        .video-box img {
            max-width: 900px;
            width: 100%;
            border-radius: 16px;
            background: #000;
            display: none;
            margin: 0 auto;
        }

        .hint {
            margin-top: 16px;
            font-size: 14px;
            color: #8b9aaa;
        }
    </style>
</head>

<body>

<div class="container">
    <h1>ğŸ¬ è§†é¢‘æ™ºèƒ½æ£€æµ‹</h1>
    <div class="subtitle">
        ä¸Šä¼ è§†é¢‘åï¼Œç³»ç»Ÿå°†é€å¸§åˆ†æå¹¶å®æ—¶å±•ç¤ºæ£€æµ‹ç»“æœ
    </div>

    <!-- æ“ä½œåŒº -->
    <div class="control-area">
        <input type="file" id="videoFile" accept="video/*">

        <button class="btn upload-btn" onclick="uploadVideo()">
            ğŸ“¤ ä¸Šä¼ è§†é¢‘
        </button>

        <button class="btn detect-btn" onclick="startDetect()">
            ğŸ¯ å¼€å§‹æ£€æµ‹
        </button>
    </div>

    <div class="status-text" id="statusText">
        è¯·é€‰æ‹©è§†é¢‘æ–‡ä»¶å¼€å§‹ä½“éªŒ âœ¨
    </div>

    <!-- è§†é¢‘å±•ç¤º -->
    <div class="video-box">
        <div class="placeholder" id="placeholder">
            ğŸ“º æ£€æµ‹ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º
        </div>

        <img id="videoStream" alt="æ£€æµ‹ç»“æœ">

        <div class="hint" id="endHint" style="display:none;">
            âœ¨ æ£€æµ‹å·²å®Œæˆï¼Œå¯ä»¥ä¸Šä¼ æ–°è§†é¢‘å†æ¬¡ä½“éªŒ
        </div>
    </div>
</div>

<script>
    let uploadedFilePath = null;
    let detectStarted = false;

    function uploadVideo() {
        const fileInput = document.getElementById("videoFile");
        const statusText = document.getElementById("statusText");

        if (!fileInput.files.length) {
            statusText.innerText = "âš ï¸ è¯·å…ˆé€‰æ‹©ä¸€ä¸ªè§†é¢‘æ–‡ä»¶";
            return;
        }

        const formData = new FormData();
        formData.append("file", fileInput.files[0]);

        statusText.innerText = "ğŸ“¤ è§†é¢‘ä¸Šä¼ ä¸­ï¼Œè¯·ç¨å€™...";

        fetch("/uploadVideo/", {
            method: "POST",
            body: formData
        })
        .then(res => res.json())
        .then(data => {
            if (data.status === 200) {
                uploadedFilePath = data.file_path;
                statusText.innerText = "âœ… ä¸Šä¼ æˆåŠŸï¼Œå¯ä»¥å¼€å§‹æ£€æµ‹å•¦";
            } else {
                statusText.innerText = "âŒ ä¸Šä¼ å¤±è´¥ï¼š" + data.msg;
            }
        })
        .catch(() => {
            statusText.innerText = "âŒ ä¸Šä¼ å¤±è´¥ï¼Œè¯·æ£€æŸ¥æœåŠ¡å™¨";
        });
    }

    function startDetect() {
        const statusText = document.getElementById("statusText");
        const videoImg = document.getElementById("videoStream");
        const placeholder = document.getElementById("placeholder");
        const endHint = document.getElementById("endHint");

        if (!uploadedFilePath) {
            statusText.innerText = "âš ï¸ è¯·å…ˆä¸Šä¼ è§†é¢‘æ–‡ä»¶";
            return;
        }

        detectStarted = true;
        placeholder.style.display = "none";
        endHint.style.display = "none";
        videoImg.style.display = "block";

        statusText.innerText = "ğŸ” æ­£åœ¨æ£€æµ‹ä¸­ï¼Œè¯·ä¿æŒé¡µé¢å¼€å¯...";
        videoImg.src = `/detectVideo/?file_path=${encodeURIComponent(uploadedFilePath)}`;

        videoImg.onerror = () => {
            if (detectStarted) {
                statusText.innerText = "ğŸ‰ æ£€æµ‹å®Œæˆ";
                endHint.style.display = "block";
                detectStarted = false;
            }
        };
    }
</script>

</body>
</html>
